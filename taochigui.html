<!DOCTYPE html>
<html>
<head>
    <title>寻找bobo</title>
    <style>
        #tcg {
            position: absolute;
            display: none;
        }
        #startagain {
            display: none;
        }
    </style>
</head>
<body>
    <header>
        <button id="startgame" style="margin-right: 20px;">开始游戏</button>
        <button id="startagain" >重新开始</button>
    </header>
    <img id="tcg" src="../taochigui.jpg" alt="taochigui">
    <audio id="whisper" src="../whisper.mp3"></audio>
    <audio id="normal" src="../normal.mp3"></audio>
    <audio id="large" src="../large.mp3"></audio>
    <audio id="shout" src="../shout.mp3"></audio>
    <audio id="mei" src="../mei.mp3"></audio>
    
    
    
    
    
    <script>

        let tcgX,tcgY;
        let whisper = document.getElementById("whisper");
        let normal = document.getElementById("normal");
        let large = document.getElementById("large");
        let shout = document.getElementById("shout");
        let mei = document.getElementById("mei")
        let currentSound = null;

        let tcg = document.getElementById("tcg");
        let startagain = document.getElementById("startagain")
        window.onload = function(){
            update();
        };

        function update(){
            tcgX = Math.random() * window.innerWidth;
            tcgY = Math.random() * window.innerHeight;
            var imageWidth = tcg.offsetWidth;
            var imageHeight = tcg.offsetHeight;
            tcg.style.left = (tcgX - imageWidth / 2) + "px";
            tcg.style.top = (tcgY - imageHeight / 2) + "px";
            tcg.style.display = " none ";
        }

        document.getElementById("startgame").addEventListener("click",startgame);
        document.getElementById("startagain").addEventListener("click",startgame)
        function startgame(){
            update();

            //计算距离，并且赋值
            function handleMouseMove(event) {
                let distance = Math.sqrt(Math.pow(event.clientX - tcgX, 2) + Math.pow(event.clientY - tcgY, 2));
                if (distance < 100) {
                    currentSound = shout;
                } else if (distance < 300) {
                    currentSound = large;
                } else if(distance <500){
                    currentSound = normal;
                } else{
                    currentSound = whisper;
                }
            }
            
            document.addEventListener("mousemove", handleMouseMove);

            //鼠标停留播放声音
            setInterval(function() {
                if (currentSound) {
                    currentSound.play();
                }
            });

            //鼠标移出界面，暂停播放
            document.addEventListener("mouseout", function() {
                currentSound = null;
            });
            
            //点击图片，结束播放
            document.addEventListener("click", function(event) {
                let distance = Math.sqrt(Math.pow(event.clientX - tcgX, 2) + Math.pow(event.clientY - tcgY, 2));
                    if (distance  <= 50) {
                        tcg.style.display = " block ";
                        startagain.style.display = " block ";
                        currentSound = null;
                        mei.play();
                        document.removeEventListener("mousemove", handleMouseMove);//点击时移除监听
                    }
            });
    }
    </script>
</body>
</html>